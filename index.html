<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Декодер Base64</title>
    <script>
        // Функция для получения параметра из URL
        function getQueryParameter(name) {
            const url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
            const results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Функция для кодирования строки в Base64
        function encodeToBase64(str) {
            try {
                const encoded = btoa(unescape(encodeURIComponent(str)));
                return encoded;
            } catch (e) {
                console.error("Ошибка при кодировании строки в Base64: ", e);
                return null;
            }
        }

        // Декодируем из Base64 в UTF-8 строку
        function decodeFromBase64(encodedStr) {
            try {
                // Убираем пробелы и другие недопустимые символы из строки Base64
                encodedStr = encodedStr.replace(/[^A-Za-z0-9+/=]/g, '');

                // Декодируем строку из Base64
                const decodedBytes = atob(encodedStr);

                // Преобразуем строку в массив байтов
                const byteArray = new Uint8Array(decodedBytes.length);
                for (let i = 0; i < decodedBytes.length; i++) {
                    byteArray[i] = decodedBytes.charCodeAt(i);
                }

                // Декодируем UTF-8 из массива байтов
                const decoder = new TextDecoder('utf-8');
                const decodedStr = decoder.decode(byteArray);

                return decodedStr;
            } catch (e) {
                console.error("Ошибка при декодировании: ", e);
                return "Ошибка при декодировании строки Base64.";
            }
        }

        // Когда страница загружена
        window.onload = function() {
            const encodedString = getQueryParameter("s"); // Получаем параметр "s" из URL

            // Если строка есть, то декодируем её
            if (encodedString) {
                const decodedString = decodeFromBase64(encodedString); // Декодируем строку
                document.getElementById("decoded-text").textContent = decodedString; // Отображаем результат
            } else {
                document.getElementById("decoded-text").textContent = "Нет данных для декодирования.";
            }
        };

        // Функция для кодирования текста и формирования ссылки с параметром
        function createBase64Link() {
            const text = prompt("Введите текст для кодирования в Base64:");
            if (text) {
                const encoded = encodeToBase64(text);
                if (encoded) {
                    const url = window.location.origin + window.location.pathname + "?s=" + encodeURIComponent(encoded);
                    alert("Ссылка для декодирования: " + url);
                } else {
                    alert("Ошибка при кодировании текста.");
                }
            }
        }
    </script>
</head>
<body>
    <h1>Результат декодирования Base64:</h1>
    <p id="decoded-text">Загрузка...</p>

    <br><br>
    <button onclick="createBase64Link()">Создать ссылку для кодирования текста</button>
</body>
</html>
